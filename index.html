<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>Haryana's 1st website HSSC CET Rank 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- pdf.js for text extraction from PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 16px;
    }
    .card {
      max-width: 480px;
      margin: 0 auto;
      background: #020617;
      border-radius: 24px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      border: 1px solid #1f2937;
    }
    h1 { margin: 0 0 4px; font-size: 22px; }
    .sub { font-size: 13px; color: #9ca3af; margin-bottom: 16px; }
    .input-box {
      border-radius: 16px;
      border: 1px dashed #374151;
      padding: 12px;
      background: #020617;
      margin-bottom: 16px;
      font-size: 13px;
    }
    input[type="file"] { width: 100%; font-size: 13px; color: #e5e7eb; }
    button {
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      cursor: pointer;
      margin-bottom: 8px;
    }
    button:disabled { opacity: 0.6; cursor: default; }
    .status { font-size: 12px; color: #a5b4fc; min-height: 18px; margin-top: 4px; }
    .error { color: #fecaca; font-size: 12px; margin-top: 4px; min-height: 18px; }
    .small { font-size: 11px; color: #9ca3af; margin-top: 10px; line-height: 1.5; }
    .section { max-width: 480px; margin: 12px auto 0; font-size: 11px; color: #9ca3af; }
    .section h2 { font-size: 12px; margin: 0 0 4px; color: #e5e7eb; }
    .link { color: #38bdf8; text-decoration: none; font-weight: 500; }

    /* new: manual roll input styles */
    .manual-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      align-items: center;
    }
    .manual-row input[type="text"] {
      flex: 1;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #071027;
      color: #e5e7eb;
      font-size: 14px;
    }
    .hint {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>HSSC CET Marks Rank 2025</h1>
    <div class="sub">
      सिर्फ आधिकारिक <b>HSSC CET Marks Card PDF</b> अपलोड करें।  
      सिस्टम PDF से आपके Marks निकाल कर <b>ऑटोमैटिक रैंक</b> calculate करेगा।  
      रैंक उतनी ही सटीक होगी जितने ज्यादा लोग इस लिंक को शेयर करके यहाँ अपनी PDF अपलोड करेंगे।
    </div>

    <div class="input-box">
      <div style="margin-bottom:8px;font-size:12px;color:#9ca3af;">
        PDF चुनें (सिर्फ Marks Card):
      </div>
      <input type="file" id="pdfInput" accept="application/pdf" />
    </div>

    <button id="uploadBtn" onclick="handleUpload()">
      Upload &amp; Submit (रैंक देखें)
    </button>

    <div class="status" id="statusText"></div>
    <div class="error" id="errorText"></div>

    <!-- NEW: Manual roll entry so previously-uploaded users can directly view result -->
    <div style="margin-top:12px; padding-top:12px; border-top:1px dashed #26303a;">
      <div style="font-weight:600; margin-bottom:6px;">पहले अपलोड कर चुका हूँ — सीधे Result देखें</div>
      <div class="manual-row">
        <input type="text" id="manualRoll" placeholder="अपना Roll number दर्ज करें (उदा. 5325003383)" />
        <button id="goResultBtn" onclick="handleManualGo()">Go</button>
      </div>
      <div class="hint">यदि आप पहले PDF अपलोड कर चुके है तो आप सीधा रोल नंबर डाल कर अपनी रैंक और कटऑफ देख सकते है ।
सभी प्रकार की updates के लिए whatsapp  channel को फॉलो करे बाद में ये चैनल आपके बहुत काम आएगा। </div>
    </div>

    <div style="margin-top:18px; text-align:center; font-size:14px;">
      <a href="https://instagram.com/adv_kanha73" target="_blank" style="text-decoration:none; color:#f9fafb; display:inline-flex; align-items:center; gap:6px;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram" style="width:20px; height:20px; border-radius:4px;" />
        <span style="font-weight:600;">@adv_kanha73</span>
      </a>
    </div>

    <br />
    <div class="small">Note: गलत / Blank / Non-HSSC PDF अपलोड करने पर एरर दिखेगा।</div>
  </div>

  <!-- Disclaimer + Terms -->
  <div class="section">
    <h2>महत्वपूर्ण सूचना (Disclaimer)</h2>
    <p>
      यह <b>कोई आधिकारिक सरकारी वेबसाइट नहीं है</b> और न ही यह HSSC या किसी सरकारी संस्था से जुड़ी हुई है।  
      यह सिर्फ विद्यार्थियों की मदद के लिए बनाया गया <b>Unofficial Rank Calculator</b> है।
    </p>

    <h2>Terms &amp; Conditions (शर्तें)</h2>
    <ul style="padding-left:18px;margin:4px 0 0;">
      <li>आप जो भी PDF अपलोड करेंगे, वह केवल <b>रैंक निकालने</b> के लिए उपयोग की जाएगी।</li>
      <li>यह वेबसाइट आपका डेटा <b>बेचती नहीं</b>, किसी तीसरे व्यक्ति को <b>शेयर नहीं करती</b> और गलत तरीके से उपयोग नहीं करती।</li>
      <li>रैंक का calculation आपके द्वारा दी गई जानकारी और अन्य users के डाटा पर आधारित है, इसलिए यह <b>official merit list</b> नहीं है।</li>
      <li>किसी भी तरह का अंतिम निर्णय हमेशा <b>HSSC के official result और notice</b> के आधार पर ही मान्य होगा।</li>
      <li>इस टूल का उपयोग करते समय आप मानते हैं कि किसी भी प्रकार के नुकसान/गलतफहमी के लिए developer जिम्मेदार नहीं होगा।</li>
      <li>इस वेबसाइट या टूल का प्रयोग आप अपनी मर्जी से कर रहे है और अपनी मर्जी से ही पीडीऍफ़ को अपलोड करते है।</li>
    </ul>
  </div>

  <script>
    // Backend URL (आपके Apps Script endpoint)
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbwHo7ecIYJP-ekEOfsCnD1BUtbSJ_nF6ZNZ2vi_hsQb6fyA0GBurHQTxWbPrm0DKZzOIQ/exec";

    // WhatsApp channel URL (पहले channel join करवाने के लिए)
    const WHATSAPP_CHANNEL_URL = "https://whatsapp.com/channel/0029Vb6kNhq8fewpVWfe1m1s";

    // pdf.js worker
    if (window["pdfjsLib"]) {
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    }

    const statusEl = document.getElementById("statusText");
    const errorEl = document.getElementById("errorText");
    const uploadBtn = document.getElementById("uploadBtn");
    const goResultBtn = document.getElementById("goResultBtn");

    function setStatus(msg) { if (statusEl) statusEl.textContent = msg || ""; }
    function setError(msg)  { if (errorEl) errorEl.textContent = msg || ""; }

    async function extractTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
      const pdf = await loadingTask.promise;
      let fullText = "";
      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        const page = await pdf.getPage(pageNum);
        const textContent = await page.getTextContent();
        const pageText = textContent.items.map(it => it.str).join(" ");
        fullText += "\n" + pageText;
      }
      return fullText;
    }

    function validateHsscPdf(text) {
      const mustHave = [
        "HARYANA STAFF SELECTION COMMISSION",
        "MARKS CARD",
        "COMMON ELIGIBILITY TEST",
        "Registration Number",
        "Roll Number",
        "Candidate's Name",
        "Gender",
        "Date Of Birth",
        "Category",
        "CET MARKS"
      ];
      const upper = text.toUpperCase();
      return mustHave.every(word => upper.includes(word.toUpperCase()));
    }

    function matchValue(text, pattern) {
      const m = text.match(pattern);
      return m && m[1] ? m[1].trim() : "";
    }

    function parseHssc(text) {
      const t = text.replace(/\s+/g, " ");
      return {
        registration: matchValue(t, /Registration Number\s+(\S+)/i),
        roll:         matchValue(t, /Roll Number\s+(\S+)/i),
        name:         matchValue(t, /Candidate'?s Name\s+([A-Z ]+)/i),
        gender:       matchValue(t, /Gender\s+([A-Za-z]+)/i),
        dob:          matchValue(t, /Date Of Birth\s+([0-9]{1,2}[-\/.][0-9]{1,2}[-\/.][0-9]{2,4})/i),
        mother:       matchValue(t, /Mother'?s Name\s+([A-Z ]+)/i),
        father:       matchValue(t, /Father'?s Name\s+([A-Z ]+)/i),
        mobile:       matchValue(t, /Mobile No.*?([0-9]{10})/i),
        category:     matchValue(t, /Category\s+([A-Z]+)/i),
        subcategory:  matchValue(t, /Sub-Category\s+([A-Z\-]+)/i) || "-",
        exam_date:    matchValue(t, /Date of Exam\s+([0-9]{1,2}[-\/.][0-9]{1,2}[-\/.][0-9]{2,4})/i),
        shift:        matchValue(t, /Shift of Exam\s+([A-Za-z]+)/i),
        cet_marks:    matchValue(t, /\(in figure\)\s*([0-9.]+)/i)
      };
    }

    function isParsedDataValid(d) {
      return d.registration && d.roll && d.name && d.gender &&
             d.dob && d.category && d.cet_marks;
    }

    // Opens WhatsApp channel in new tab and after a delay navigates current tab to given URL
    function openWhatsAppThenNavigate(targetUrl, delay = 700) {
      try {
        window.open(WHATSAPP_CHANNEL_URL, "_blank");
      } catch (e) {
        console.log("WhatsApp open blocked:", e);
      }
      setTimeout(() => {
        window.location.href = targetUrl;
      }, delay);
    }

    // Upload handler (unchanged behavior, but uses openWhatsAppThenNavigate)
    async function handleUpload() {
      setStatus("");
      setError("");

      const file = document.getElementById("pdfInput").files[0];

      if (!file) {
        setError("कृपया पहले PDF चुनें।");
        return;
      }
      if (file.type !== "application/pdf") {
        setError("सिर्फ PDF फाइल ही चुनें।");
        return;
      }

      uploadBtn.disabled = true;
      setStatus("PDF पढ़ी जा रही है...");

      try {
        const text = await extractTextFromPDF(file);

        if (!validateHsscPdf(text)) {
          setError("यह HSSC CET Marks Card PDF नहीं लग रही।");
          uploadBtn.disabled = false;
          setStatus("");
          return;
        }

        setStatus("डेटा निकाला जा रहा है...");
        const user = parseHssc(text);

        if (!isParsedDataValid(user)) {
          setError("PDF से जरूरी डेटा नहीं मिला।");
          uploadBtn.disabled = false;
          setStatus("");
          return;
        }

        setStatus("Backend में सेव करने की request भेज दी गई है...");

        try {
          // send to backend (no-cors used previously; if backend supports CORS, better to remove no-cors)
          fetch(BACKEND_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify(user)
          }).catch((e) => {
            console.log("Backend fetch error (ignored):", e);
          });
        } catch (e) {
          console.log("Fetch throw हुआ:", e);
        }

        // Open WhatsApp first, then navigate to result page with roll
        const target = `result.html?roll=${encodeURIComponent(user.roll)}`;
        // small delay to let UI update
        setTimeout(() => {
          openWhatsAppThenNavigate(target, 900); // 900ms so user sees whatsapp open
        }, 200);

      } catch (err) {
        console.error(err);
        setError("कुछ गड़बड़ हो गई (Network / Script error)।");
        setStatus("");
        uploadBtn.disabled = false;
      }
    }

    // Manual roll -> open WhatsApp then result
    function handleManualGo() {
      setError("");
      setStatus("");

      const rollInput = document.getElementById("manualRoll");
      if (!rollInput) return;
      const roll = rollInput.value.trim();
      if (!roll) {
        setError("कृपया Roll number डालें।");
        return;
      }
      // basic check: digits only (adjust as per your real roll format)
      if (!/^\d{6,12}$/.test(roll)) {
        setError("Roll format सही नहीं लग रहा। केवल digits डालें (6-12 अंक)।");
        return;
      }

      setStatus("Redirecting to result...");

      const target = `result.html?roll=${encodeURIComponent(roll)}`;
      openWhatsAppThenNavigate(target, 700);
    }

    // Optional: allow Enter key on manualRoll input
    document.addEventListener("DOMContentLoaded", () => {
      const r = document.getElementById("manualRoll");
      if (r) {
        r.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            handleManualGo();
          }
        });
      }
    });
  </script>

  <footer style="
    background:#000;
    color:#fff;
    padding:18px 12px;
    text-align:center;
    font-size:15px;
    border-top:2px solid #444;
    box-shadow:0 -2px 10px rgba(0,0,0,0.4);
">
    <div style="margin-bottom:6px;">
        Helped by 
        <a href="https://youtube.com/@uttamclasses1725?si=Ug0rXzzeHoLGtMai" 
           target="_blank" 
           style="color:#ff4d4d; text-decoration:none; font-weight:bold; display:inline-flex; align-items:center;">
           
           <!-- YouTube Logo SVG -->
           <svg width="18" height="18" viewBox="0 0 24 24" fill="#ff0000" style="margin-right:5px;">
               <path d="M19.615 3.184A3.01 3.01 0 0 1 21.5 5.006C22 7.205 22 12 22 12s0 4.795-.5 6.994a3.01 3.01 0 0 1-1.885 1.822C17.873 21.5 12 21.5 12 21.5s-5.873 0-7.615-.684A3.01 3.01 0 0 1 2.5 18.994C2 16.795 2 12 2 12s0-4.795.5-6.994A3.01 3.01 0 0 1 4.385 3.184C6.127 2.5 12 2.5 12 2.5s5.873 0 7.615.684ZM10 8.5v7l6-3.5-6-3.5Z"/>
           </svg>

           UttamClasses1725
        </a>
    </div>

    <div>
        Website developed by <strong>KANHAIYA PRAJAPATI</strong>
    </div>
</footer>

</body>
</html>


